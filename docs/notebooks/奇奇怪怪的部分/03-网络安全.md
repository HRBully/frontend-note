# 潜伏在浏览器中的网络安全

## 前言

安全是每个人都希望拥有的东西，而现在这个时代，网络安全与我们的生活密不可分，其包括很多种： 系统信息的安全,包括用户口令鉴别、用户存取权限控制、数据存取权限、方式控制、安全审计、计算机病毒、数据加密等。而浏览器是网络安全的重灾区，不经意间就会被不法分子通过网络攻击侵害，本文讲介绍常见于浏览器中的网络攻击及浏览器做出的相应安全策略。

## 跨站请求伪造

### 概念

跨站请求攻击，简单地说，是攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并运行一些操作（如发邮件，发消息，甚至财产操作如转账和购买商品）。由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去运行。这利用了web中用户身份验证的一个漏洞：**简单的身份验证只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的**，这种网络攻击是很容易给我们的财产造成巨大的损失。

### 举例

假如一家银行用以运行转账操作的URL地址：`http://www.bank.com/withdraw?account=AccoutName&amount=1000&for=PayeeName`，一个恶意攻击者可以在另一个网站上放置如下代码： `<img src="http://www.examplebank.com/withdraw?account=cxy&amount=1000&for=Badman">`如果有账户名为`cxy`的用户访问了恶意站点，而他之前刚访问过银行不久，登录信息尚未过期，那么她就会损失1000人民币。这种恶意的网址可以有很多种形式，藏身于网页中的许多地方。此外，攻击者也不需要控制放置恶意网址的网站。例如他可以将这种地址藏在论坛，博客等任何用户生成内容的网站中。这意味着如果服务端没有合适的防御措施的话，用户即使访问熟悉的可信网站也有受攻击的危险。透过例子能够看出，攻击者并不能通过CSRF攻击来直接获取用户的账户控制权，也不能直接窃取用户的任何信息。他们能做到的，是**欺骗用户浏览器，让其以用户的名义运行操作**

### 检查Referer字段

HTTP头中有一个Referer字段，这个字段用以标明请求来源于哪个地址。在处理敏感数据请求时，通常来说，Referer字段应和请求的地址位于同一域名下。以上文银行操作为例，Referer字段地址通常应该是转账按钮所在的网页地址，应该也位于www.examplebank.com之下。而如果是CSRF攻击传来的请求，Referer字段会是包含恶意网址的地址，不会位于www.examplebank.com之下，这时候服务器就能识别出恶意的访问。

这种办法简单易行，工作量低，仅需要在关键访问处增加一步校验。但这种办法也有其局限性，因其完全依赖浏览器发送正确的Referer字段。虽然http协议对此字段的内容有明确的规定，但并无法保证来访的浏览器的具体实现，亦无法保证浏览器没有安全漏洞影响到此字段。并且也存在攻击者攻击某些浏览器，篡改其Referer字段的可能。

### 添加校验token

由于CSRF的本质在于攻击者欺骗用户去访问自己设置的地址，所以如果要求在访问敏感数据请求时，要求用户浏览器提供不保存在cookie中，并且攻击者无法伪造的数据作为校验，那么攻击者就无法再运行CSRF攻击。这种数据通常是窗体中的一个数据项。服务器将其生成并附加在窗体中，其内容是一个伪随机数。当客户端通过窗体提交请求时，这个伪随机数也一并提交上去以供校验。正常的访问时，客户端浏览器能够正确得到并传回这个伪随机数，而通过CSRF传来的欺骗性攻击中，攻击者无从事先得知这个伪随机数的值，服务端就会因为校验token的值为空或者错误，拒绝这个可疑请求。

## 浏览器中的HTTPS

HTTPS全称为Hypertext Transfer Protocol over Secure Socket Layer，中文含义为“超文本传输协议在安全加密字层”，简单来说就是加密数据传输，通俗的说就是安全连接。它是一个安全通信通道，它基于HTTP开发，用于在客户计算机和服务器之间交换信息。它使用安全套接字层(SSL)进行信息交换，简单来说它是HTTP的安全版。

这个系统的最初研发由网景公司进行，提供了身份验证与加密通讯方法，现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。它是由Netscape开发并内置于其浏览器中，用于对数据进行压缩和解压操作，并返回网络上传送回的结果。HTTPS实际上应用了Netscape的安全套接字层(SSL)作为HTTP应用层的子层。(HTTPS使用端口443，而不是象HTTP那样使用端口80来和TCP/IP进行通信。)SSL使用40 位关键字作为RC4流加密算法，这对于商业信息的加密是合适的。

### 为什么要使用https安全连接

如果您的邮件中有敏感数据，不希望被人窃听;如果您不希望被钓鱼网站盗用帐号信息;如果您希望您在使用邮箱的过程中更安全;那么我们推荐您使用https安全连接。

### HTTP 和 HTTPS 的相同点

大多数情况下，HTTP 和 HTTPS 是相同的，因为都是采用同一个基础的协议，作为 HTTP 或 HTTPS 客户端——浏览器，设立一个连接到 Web 服务器指定的端口。当服务器接收到请求，它会返回一个状态码以及消息，这个回应可能是请求信息、或者指示某个错误发送的错误信息。系统使用统一资源定位器 URI 模式，因此资源可以被唯一指定。而 HTTPS 和 HTTP 唯一不同的只是一个协议头(https)的说明，其他都是一样的。

### HTTPS和HTTP的区别

- HTTP 的 URL 以 http:// 开头，而 HTTPS 的 URL 以 https:// 开头。

- HTTP 是不安全的，而 HTTPS 是安全的。

- HTTP 标准端口是 80 ，而 HTTPS 的标准端口是 443。

- 在 OSI 网络模型中，HTTP 工作于应用层，而 HTTPS 工作在传输层。

- HTTP 无需加密，而 HTTPS 对传输的数据进行加密。

- HTTP 无需证书，而 HTTPS 需要认证证书。

### HTTP与HTTPS的优缺点

- HTTPS更安全：HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比HTTP协议安全。

- HTTPS需要申请证书：HTTPS协议需要到ca申请证书，一般免费证书很少，需要交费，费用大概与.COM域名差不多，每年需要交大约几十元的费用。而常见的http协议则没有这一项;

- 端口不同：HTTP使用的是大家最常见的80端口，而HTTPS连接使用的是443端口;

- 状态不同：HTTP的连接很简单，是无状态的。而HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全

### HTTPS解决的问题

信任主机的问题. 采用https 的server 必须从CA 申请一个用于证明服务器用途类型的证书. 改证书只有用于对应的server 的时候，客户度才信任次主机. 所以目前所有的银行系统网站，关键部分应用都是https 的。 客户通过信任该证书，从而信任了该主机. 其实这样做效率很低，但是银行更侧重安全. 这一点对我们没有任何意义，我们的server ，采用的证书不管自己issue 还是从公众的地方issue， 客户端都是自己人，所以我们也就肯定信任该server。