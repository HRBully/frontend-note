# 存储器

## 层次结构

1. 寄存器，容量小速度快，在CPU内
2. 一级cache：高速缓冲存储器（容量小，速度快）在cpu内
3. 二级cache：容量大，速度慢，在主板内
4. 主存储器（主存），计算机系统主要存储器，存放运行期间的程序和数据，容量大，速度慢，在主板内
5. 外存储器（外存），大容量辅助存储器
6. cpu直接访问的是内存器：cache+主存，可以直接进行信息交换。

## 分类

1. 随机存储器（RAM），可以根据一个地址，根据地址找到对应数据，任何存储单元内容都能被随机存取
2. 顺序存储器，只能按某种顺序存取，如磁带
3. 半顺序存储器，磁道方向顺序存取，垂直半径随机存取

### 按存储读写分

1. 只读存储器（ROM）
2. 随机存储器（RAM）

### 按易失分

1. 易失/非易失存储器

## 技术指标

1. 字存储单元：存放一个机器字的存储单元，单元地址为字地址

2. 字节存储单元：存储一个字节单元，单元地址为字节地址

3. 存储容量：

   - 主存容量：以Byte为单位衡量
   - 半导体存储芯片：以Bit为基本单位
   - 存储容量以2^10=1024规律表达
   - 厂商以10^3=1000规律表达

4. 存取时间（访问时间）

   - 一次发出读写命令到数据传输操作完成所经过的时间

5. 存取周期

   - 两次存储器访问所允许的最小时间间隔
   - 存取周期大于等于存取时间

6. 存储器带宽

   - 单位时间内存储器所存取的信息量，以bit/秒或者Byte/秒

**速度指标**：存取时间，存取周期，存储器带宽

## SRAM存储器

> 静态存储器

- 以触发器为基本存储单元
- 不需要额外的刷新电路
- 速度快，集成度低，功耗和价格较高

### 存储体

将各个字的同一个字的一位集成在一个芯片上，32位排成256*128矩阵

### 地址译码器

使用双译码方式

### 读写的互锁逻辑

G1为片选信号，CS有效的时候，G1G2均被打开，G1与G2门是互锁的

## DRAM存储器

> 动态存储

- 以单个MOS管为基本存储单元
- 要不断进行刷新操作
- 集成度高，价格低，功耗小，但是速度慢



## chache

主要目的是提升存储器速度，即cpu与主存之间的速度，由SRAM组成

CPU与chache之间的数据交换以**字节**为单位

chache与主存之间的数据传送以**数据块**为单位

### 主要原理

1. cache发出访问操作，由cache控制器判断当前请求的字是否在cache中，在则命中，不在则不命中
2. 若命中在判断读or写请求
   - 若读：直接对cache读，与主存无关
   - 若写：
     - cache单元和主存单元同时进行写
     - 只更新cache，在移出该数据块的时候再修改主存
     - 只写入主存，在cache中添加标记
3. 未命中时，需要cpu和主存进行寻找
   - 若读：在主存中读取所需的字，传给cpu，把含有该字的块送往cache（**装入通过**）若cache已经满了则进行替换算法。
   - 若写：直接写入主存

主存的数据中部分地址会拷贝到cache上（**地址映射**），cpu在cache中查询相关地址，cpu在其找到称为**命中**，进行字交换，如果cpu在cache中没有找到则在主存中查找并进行数据交换

- 地址映射：主存的数据中部分地址会拷贝到cache上
- 替换策略：cache数据存满后，还要继续进行数据存放，则可以进行数据的替换，即为替换策略，将最近最少使用的数据块会被替换掉
- 写一致性：对cache进行数据修改，则还需要对主存内对应的数据进行修改，即写一致性
- 性能评价：在cache中的命中率，寻找时间，平均访问时间等等

### 命中率计算

为了增加性能即使cache满足CPU需要的部分占更高的比例，则需要cache的命中率**接近于1**

Nc为cache完成存取的总次数

Nm为主存完成存取的总次数

h定义为命中率则有：h=Nc/（Nc+Nm）

**tc**表示命中cache的访问时间，**tm**未命中时主存访问时间，**1-h**为未命中率，cache/主存系统的平均访问时间ta为**ta = htc+（1-h）tm**

**以最小的硬件代价**使cache/主存系统的ta越接近于tc越好

**r=tm/tc**访问效率e=tc/ta=1/（r+（1-r）h）

**r**值为5-10为好，**h**接近于1越好

### 地址映射

若想主存将块放入cache中，必须使用某种方法把主存地址定位到cache中，这个过程为**地址映射**

需要考虑

- 硬件时分容易实现
- 地址变换速率

映射相关方法：cache通过地址映射确定主存块与cache行之间的对应关系，确定主存块应该存放在哪个cache行中

- 全相联映射：将主存块存储到任意一个cache行

  标记位为s位，主存块数为2^s

  1. 冲突概率小，cache利用率高
  2. 比较器难实现

- 直接映射：将主存块存储到唯一的一个cache行

  标记位为s-r，其他不变

- 组相联映射：可以将主存块存储到唯一的一个cache组的任意一个行（全相联与直接的结合）


### 替换策略

1. 最不常用
2. 最近最少使用
3. 随机法

### 写操作策略

写操作会有如下问题

- 确认命中问题
- 写入得数据字数不定
- 主存与cache内容不一致

写入策略：

- 写回法：只修改cache内容，换出时对修改位进行判断决定写回还是舍弃，通过设置修改位来实现（1/0）
- 全写法：写命中时，cache与内存一起写
- 写一次法：与写回法一致，但是第一次cache命中得时候采用全写法